<div class="mb-3">
    <button class="btn btn-primary" id="btnCreateInstitution">
        Créer Institution
    </button>
    <button class="btn btn-info" id="btnDetailsInstitution">
        Voir Détails
    </button>
</div>

<!-- Formulaire Create -->
<div id="formInstitution" class="mb-4" style="display:none">
    <textarea id="jsonInstitution"
              class="form-control"
              rows="6"
              placeholder='{"IdInstitutionSectorielle":1,...}'></textarea>
    <button class="btn btn-success mt-2"
            onclick="execProc('AJOUTER_INSTITUTION_SECTORIELLE_ET_LISTES_JSON','jsonInstitution')">
        Valider
    </button>
</div>

<!-- Grille Details -->
<table id="tblInstitution" class="table table-striped" style="display:none">
    <thead>
        <tr>
            <th>ID</th>
            <th>Nom</th>
        </tr>
    </thead>
    <tbody></tbody>
</table>

<script>
    $('#btnCreateInstitution').click(()=> {
      $('#tblInstitution').hide();
      $('#formInstitution').toggle();
    });
    $('#btnDetailsInstitution').click(()=>{
      $('#formInstitution').hide();
      $('#tblInstitution').toggle();
      if ($('#tblInstitution tbody tr').length===0) loadDetails();
    });

    function execProc(proc, textareaId){
      let json = $('#' + textareaId).val();
      $.post('@Url.Action("ExecuteProcedure")',
             { procName: proc, jsonPayload: json },
             ()=> alert('Succès'), 'json');
    }

    function loadDetails(){
      $.getJSON('@Url.Action("GetInstitutions")', data => {
        let html = data.map(r=>
          `<tr><td>${r.ID_INSTITUTION_SECTORIELLE}</td>
               <td>${r.NOM_INSTITUTION_SECTORIELLE}</td>
           </tr>`).join('');
        $('#tblInstitution tbody').html(html);
      });
    }
</script>

